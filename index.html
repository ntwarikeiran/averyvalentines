<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Retro Love Letter üíå</title>

<!-- Fonts: elegant script + vintage serif -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">

<style>
/* =========================
   THEME: Retro love letter
========================= */
:root{
  --red:#B11226;         /* cherry red */
  --pink:#E8A1B0;        /* soft pink */
  --paper:#FFF4E8;       /* cream paper */
  --ink:#1F1A1A;         /* ink black */
  --paper2:#FDE9EF;      /* blush wash */
  --shadow: 0 18px 55px rgba(177,18,38,.16);
}

/* Per-page background "ink wash" (fades smoothly) */
body[data-scene="welcome"]{ --washA:#FFF4E8; --washB:#FDE9EF; --washC:#FFE1EA; }
body[data-scene="game1"] { --washA:#FFF4E8; --washB:#FFE7F1; --washC:#FFF1DE; }
body[data-scene="game2"] { --washA:#FFF4E8; --washB:#FFE1EA; --washC:#FDE9EF; }
body[data-scene="game3"] { --washA:#FFF4E8; --washB:#FDE9EF; --washC:#FFE7F1; }
body[data-scene="final"] { --washA:#FFF4E8; --washB:#FFE1EA; --washC:#FFF1DE; }

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  color:var(--ink);
  background:
    radial-gradient(1200px 800px at 20% 12%, color-mix(in srgb, var(--pink) 18%, white) 0%, transparent 60%),
    radial-gradient(1100px 700px at 85% 15%, color-mix(in srgb, var(--red) 10%, white) 0%, transparent 55%),
    linear-gradient(180deg, var(--washA), var(--washB), var(--washC));
  transition: background 900ms ease;
  overflow:hidden;
  font-family: "IM Fell English", serif;
}

/* Paper texture overlay (subtle + scanned vibe) */
body::before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:.18;
  mix-blend-mode:multiply;
  background-image:
    radial-gradient(circle at 20% 20%, rgba(0,0,0,.05) 0%, transparent 40%),
    radial-gradient(circle at 80% 35%, rgba(0,0,0,.04) 0%, transparent 38%),
    radial-gradient(circle at 40% 80%, rgba(0,0,0,.03) 0%, transparent 42%),
    repeating-linear-gradient(0deg, rgba(0,0,0,.015) 0px, rgba(0,0,0,.015) 1px, transparent 2px, transparent 5px);
}

/* Faint paper fold lines */
body::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:.12;
  mix-blend-mode:multiply;
  background:
    /* vertical fold */
    linear-gradient(90deg,
      transparent 0%,
      transparent 49.5%,
      rgba(0,0,0,.10) 50%,
      transparent 50.5%,
      transparent 100%),
    /* horizontal fold */
    linear-gradient(180deg,
      transparent 0%,
      transparent 57.5%,
      rgba(0,0,0,.09) 58%,
      transparent 58.5%,
      transparent 100%),
    /* tiny crease noise */
    repeating-linear-gradient(135deg, rgba(0,0,0,.02) 0px, rgba(0,0,0,.02) 1px, transparent 2px, transparent 10px);
}

/* Full-screen pages */
.page{
  position:fixed;
  inset:0;
  display:none;
  padding: clamp(18px, 4vw, 54px);
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  animation: pageIn 700ms ease both;
}
.page.active{ display:block; }

@keyframes pageIn{
  from{ opacity:0; transform: translateY(10px); }
  to{ opacity:1; transform: translateY(0); }
}

/* Centered poster layout */
.poster{
  width:min(900px, 96vw);
  margin:0 auto;
  padding: clamp(18px, 4vw, 32px);
  position:relative;
}

/* Hand-drawn divider */
.divider{
  margin: 18px auto 6px;
  width: min(520px, 92vw);
  height: 18px;
  opacity:.9;
  background:
    radial-gradient(circle at 12px 9px, rgba(177,18,38,.35) 0 2px, transparent 3px),
    radial-gradient(circle at 24px 9px, rgba(177,18,38,.25) 0 2px, transparent 3px),
    radial-gradient(circle at 36px 9px, rgba(177,18,38,.35) 0 2px, transparent 3px),
    repeating-linear-gradient(90deg,
      rgba(177,18,38,.0) 0px,
      rgba(177,18,38,.0) 10px,
      rgba(177,18,38,.25) 11px,
      rgba(177,18,38,.0) 14px);
  border-radius:999px;
}

/* Type */
.h1{
  font-family:"Great Vibes", cursive;
  font-size: clamp(54px, 8vw, 86px);
  color: var(--red);
  text-align:center;
  margin: 0 0 6px;
  line-height: 1.0;
}
.h2{
  font-family:"Great Vibes", cursive;
  font-size: clamp(34px, 5.4vw, 54px);
  color: var(--red);
  text-align:center;
  margin: 0 0 8px;
  line-height: 1.0;
}
.p{
  font-size: clamp(16px, 2.1vw, 18px);
  line-height: 1.75;
  text-align:center;
  margin: 10px auto;
  max-width: 56ch;
}

/* Buttons: soft, analog */
.btnrow{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
  margin-top: 16px;
  position:relative; /* so maybe can run around inside */
  min-height: 58px;
}

.btn{
  border:0;
  cursor:pointer;
  padding: 12px 22px;
  border-radius: 999px;
  font-weight: 700;
  font-family: "IM Fell English", serif;
  letter-spacing: .2px;
  transition: transform .12s ease, filter .25s ease, box-shadow .25s ease;
  will-change: transform;
}
.btn:active{ transform: translateY(1px) scale(.99); }

.btn.primary{
  background: linear-gradient(135deg, var(--red), color-mix(in srgb, var(--red) 70%, var(--pink)));
  color: #fff;
  box-shadow: 0 14px 30px rgba(177,18,38,.28);
}
.btn.primary:hover{ filter: brightness(1.03); box-shadow: 0 18px 40px rgba(177,18,38,.32); }

.btn.ghost{
  background: rgba(255,255,255,.55);
  border: 1.5px dashed rgba(177,18,38,.45);
  color: var(--red);
}
.btn.ghost:hover{ filter: brightness(1.02); }

/* Locked helper */
.lockNote{
  text-align:center;
  font-size: 14px;
  opacity:.8;
  margin-top: 10px;
}

/* Tiny toast */
.toast{
  position:fixed;
  left:50%;
  bottom: 22px;
  transform: translateX(-50%);
  padding: 10px 14px;
  border-radius: 999px;
  background: rgba(0,0,0,.78);
  color:#fff;
  font-weight: 800;
  opacity:0;
  transition: opacity .2s ease;
  z-index: 99999;
}
.toast.show{ opacity:1; }

/* Confetti hearts */
.confetti{
  position:fixed;
  top:-24px;
  pointer-events:none;
  z-index: 9999;
  animation: confFall linear forwards;
}
@keyframes confFall{
  to{ transform: translateY(112vh) rotate(360deg); opacity:0; }
}

/* =========================
   WELCOME: only button + big heart bg
========================= */
#welcomeWrap{
  min-height: calc(100vh - 120px);
  display:grid;
  place-items:center;
  position:relative;
}
#welcomeWrap::before{
  content:"‚ù§";
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  font-size: min(70vw, 520px);
  color: rgba(177,18,38,.10);
  transform: rotate(-8deg);
  filter: blur(.2px);
}
.pulse{
  animation: pulse 1.2s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{ transform: translateY(0) scale(1); }
  50%{ transform: translateY(-1px) scale(1.03); }
}

/* =========================
   GAME 1: CROSSWORD GRID (row-style crossword)
========================= */
.cwWrap{
  width:min(860px, 96vw);
  margin: 10px auto 0;
  display:grid;
  grid-template-columns: 1fr;
  gap: 16px;
}

.cwGrid{
  width:min(760px, 96vw);
  margin:0 auto;
  display:grid;
  gap: 10px;
}

.cwRow{
  display:flex;
  gap: 8px;
  justify-content:center;
  flex-wrap:wrap;
  padding: 10px 8px;
  border-radius: 18px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.52);
  box-shadow: 0 14px 34px rgba(0,0,0,.08);
  position:relative;
}

.cwRow.correct{
  border-color: rgba(40,167,69,.35);
  background: rgba(40,167,69,.08);
}

.cell{
  width:52px;
  height:58px;
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.75);
  box-shadow: 0 10px 22px rgba(0,0,0,.06);
  position:relative;
  overflow:hidden;
  display:grid;
  place-items:center;
}

.number{
  position:absolute;
  top: 6px;
  left: 8px;
  font-size: 11px;
  font-weight: 900;
  opacity:.55;
}

.cell input{
  width:100%;
  height:100%;
  border:0;
  background:none;
  outline:none;
  text-align:center;
  font-size: 24px;
  font-weight: 900;
  text-transform: uppercase;
  color: var(--ink);
  font-family: "IM Fell English", serif;
}

.clues{
  width:min(740px, 96vw);
  margin: 0 auto;
  padding: 14px 14px;
  border-radius: 18px;
  background: rgba(255,255,255,.60);
  border: 1px solid rgba(0,0,0,.08);
}
.clue{
  display:flex;
  gap:10px;
  align-items:flex-start;
  padding: 10px 10px;
  border-radius: 14px;
  background: rgba(255,255,255,.55);
  border: 1px dashed rgba(177,18,38,.20);
  margin: 10px 0;
}
.clue b{ min-width: 20px; color: var(--red); }

/* =========================
   GAME 2: Quiz
========================= */
.quizBox{
  width: min(720px, 96vw);
  margin: 16px auto 0;
  padding: 16px;
  border-radius: 20px;
  background: rgba(255,255,255,.65);
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 16px 50px rgba(0,0,0,.10);
}
.qTitle{
  font-weight: 900;
  margin-bottom: 12px;
  text-align:center;
  font-size: clamp(18px, 2.6vw, 22px);
}
.choices{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.choice{
  width:100%;
  text-align:left;
  padding: 14px 16px;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.85);
  cursor:pointer;
  font-weight: 700;
  font-family: "IM Fell English", serif;
  font-size: 18px;
}
.choice:hover{ filter: brightness(1.02); }
.choice.selected{ outline: 3px solid rgba(177,18,38,.18); }
.choice.correct{ border-color: rgba(40,167,69,.35); background: rgba(40,167,69,.10); }
.choice.wrong{ border-color: rgba(177,18,38,.30); background: rgba(177,18,38,.08); }

/* =========================
   GAME 3: Heart catch
========================= */
.hud{
  width:min(740px, 96vw);
  margin: 10px auto 10px;
  display:flex;
  justify-content:space-between;
  gap:12px;
  font-weight:900;
  font-size: 18px;
}
.arena{
  width:min(740px, 96vw);
  height: min(56vh, 420px);
  margin:0 auto;
  border-radius:20px;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.60);
  position:relative;
  overflow:hidden;
  box-shadow: 0 16px 55px rgba(0,0,0,.10);
}
.fall{
  position:absolute;
  top:-32px;
  user-select:none;
  cursor:pointer;
  filter: drop-shadow(0 10px 14px rgba(0,0,0,.16));
  animation: fall linear forwards;
}
@keyframes fall{
  to{ transform: translateY(120%); opacity:.95; }
}

/* =========================
   FINAL: Wax-sealed postcard + obnoxious yes mode
========================= */
.postcard{
  width: min(920px, 96vw);
  margin: 24px auto 0;
  padding: 36px 32px 44px;
  border-radius: 26px;
  background: linear-gradient(180deg, #FFFDF7, var(--paper));
  border: 3px solid rgba(177,18,38,.55);
  box-shadow: 0 26px 85px rgba(0,0,0,.16);
  position: relative;
}

.postmark{
  position:absolute;
  top:16px;
  right:16px;
  width: 140px;
  height: 92px;
  border-radius: 14px;
  border: 2px dashed rgba(0,0,0,.16);
  background: rgba(255,255,255,.55);
  transform: rotate(5deg);
  display:grid;
  place-items:center;
  font-weight: 900;
  font-size: 12px;
  letter-spacing: .7px;
  text-transform: uppercase;
  opacity: .9;
}
.postmark span{ display:block; text-align:center; line-height:1.1; }

.kiss{
  position:absolute;
  top: 104px;
  right: 44px;
  font-size: 30px;
  transform: rotate(-10deg);
  opacity:.85;
}

/* Wax seal stamp */
.waxSeal{
  position:absolute;
  left: 22px;
  bottom: 18px;
  width: 130px;
  height: 130px;
  border-radius: 50%;
  background: linear-gradient(145deg, #B11226, #7C0D1A);
  box-shadow: 0 22px 48px rgba(0,0,0,.28);
  transform: rotate(-10deg);
  transform-origin: 60% 70%;
}
.waxSeal::before{
  content:"‚ù§";
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  color: rgba(255,255,255,.86);
  font-size: 42px;
  text-shadow: 0 10px 20px rgba(0,0,0,.25);
  opacity: .95;
  transform: translateY(1px);
}
.waxSeal::after{
  content:"";
  position:absolute;
  inset:-8px;
  border-radius:50%;
  background: rgba(0,0,0,.12);
  filter: blur(12px);
  opacity: 0;
  transform: translateY(12px) scale(.9);
  z-index:-1;
}

/* stamp animation (re-triggered via JS) */
.waxSeal.stamp{ animation: sealStamp 720ms cubic-bezier(.2,.9,.25,1.05) both; }
.waxSeal.stamp::after{ animation: sealShadow 720ms cubic-bezier(.2,.9,.25,1.05) both; }

@keyframes sealStamp{
  0%{ opacity:0; transform: translateY(-30px) rotate(-18deg) scale(.92); }
  55%{ opacity:1; transform: translateY(0) rotate(-10deg) scale(1.07); }
  72%{ transform: translateY(0) rotate(-10deg) scale(.99); }
  100%{ opacity:1; transform: translateY(0) rotate(-10deg) scale(1); }
}
@keyframes sealShadow{
  0%{ opacity:0; transform: translateY(16px) scale(.86); }
  55%{ opacity:.35; transform: translateY(7px) scale(.99); }
  72%{ opacity:.18; transform: translateY(9px) scale(.92); }
  100%{ opacity:.28; transform: translateY(8px) scale(.95); }
}

/* Meme block */
.memeBlock{
  width: min(800px, 96vw);
  margin: 26px auto 0;
  padding: 18px;
  border-radius: 22px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.70);
  box-shadow: 0 18px 60px rgba(0,0,0,.12);
  transform: rotate(-.7deg);
  text-align:center;
}
.memeBlock img{
  width:100%;
  height:auto;
  display:block;
  border-radius: 18px;
}
.memeCap{
  margin-top: 12px;
  font-weight: 900;
  opacity:.9;
  font-size: 20px;
}
.memeCap.small{
  opacity:.65;
  font-weight: 800;
  font-size: 15px;
}

/* OBNOXIOUS PARTY MODE (only on YES) */
body.party{
  animation: partyFlash 1.05s linear infinite;
}
@keyframes partyFlash{
  0%   { filter: hue-rotate(0deg) saturate(1.05); }
  50%  { filter: hue-rotate(28deg) saturate(1.5); }
  100% { filter: hue-rotate(0deg) saturate(1.05); }
}

/* FINAL PAGE: BIG MODE */
#p4 .h2{
  font-size: clamp(48px, 7vw, 86px);
  margin-bottom: 18px;
}
#p4 .p{ font-size: clamp(18px, 2.6vw, 22px); }

/* Bigger buttons on final page */
#p4 .btn{
  padding: 18px 36px;
  font-size: 20px;
}
#p4 .btn.primary{
  font-size: 22px;
}

/* "YES grows" visual smoothing */
#yesBtn{
  transform-origin: center;
  will-change: transform;
}
</style>
</head>

<body data-scene="welcome">
  <div class="toast" id="toast"></div>

  <!-- =========================
       PAGE 0: WELCOME (button only)
  ========================== -->
  <section class="page active" id="p0">
    <div class="poster" id="welcomeWrap">
      <div class="btnrow">
        <button class="btn primary pulse" id="startBtn" style="font-size:22px;padding:18px 38px;">
          Click here üíå
        </button>
      </div>
    </div>
  </section>

  <!-- =========================
       PAGE 1: GAME 1 (CROSSWORD GRID)
  ========================== -->
  <section class="page" id="p1">
    <div class="poster">
      <div class="h2">Game 1</div>
      <p class="p">Fill the crossword. One row = one answer. Don‚Äôt embarrass me üòå</p>
      <div class="divider"></div>

      <div class="cwWrap">
        <div class="cwGrid" id="cwGrid"></div>
        <div class="clues" id="clues"></div>
      </div>

      <div class="btnrow">
        <button class="btn ghost" id="cwClearBtn">Clear</button>
        <button class="btn primary" id="cwCheckBtn">Check</button>
      </div>

      <p class="p" id="cwMsg" style="min-height:2.2em;"></p>

      <div class="btnrow" id="g1NextRow" style="display:none">
        <button class="btn primary" id="g1Next">Next page ‚Üí</button>
      </div>
    </div>
  </section>

  <!-- =========================
       PAGE 2: GAME 2 (QUIZ)
  ========================== -->
  <section class="page" id="p2">
    <div class="poster">
      <div class="h2">Game 2</div>
      <p class="p">Pick the right answer. Like you‚Äôre choosing me. üòå</p>
      <div class="divider"></div>

      <div class="quizBox" id="quizBox"></div>

      <div class="btnrow">
        <button class="btn ghost" id="qReset">Reset</button>
        <button class="btn primary" id="qSubmit">Submit</button>
      </div>

      <p class="p" id="qMsg" style="min-height: 2.2em;"></p>

      <div class="btnrow" id="g2NextRow" style="display:none">
        <button class="btn primary" id="g2Next">Next page ‚Üí</button>
      </div>
    </div>
  </section>

  <!-- =========================
       PAGE 3: GAME 3 (HEART CATCH)
  ========================== -->
  <section class="page" id="p3">
    <div class="poster">
      <div class="h2">Game 3</div>
      <p class="p">Catch hearts before they fall. Be so serious. üíñ</p>
      <div class="divider"></div>

      <div class="hud">
        <div>Score: <span id="score">0</span>/<span id="goal">10</span></div>
        <div>Time: <span id="time">12</span>s</div>
      </div>

      <div class="arena" id="arena" aria-label="heart catch arena"></div>

      <div class="btnrow">
        <button class="btn ghost" id="hcReset">Reset</button>
        <button class="btn primary" id="hcStart">Start</button>
      </div>

      <p class="p" id="hcMsg" style="min-height: 2.2em;"></p>

      <div class="btnrow" id="g3NextRow" style="display:none">
        <button class="btn primary" id="g3Next">Final page üíå</button>
      </div>
    </div>
  </section>

  <!-- =========================
       PAGE 4: FINAL (WAX POSTCARD)
  ========================== -->
  <section class="page" id="p4">
    <div class="poster">
      <div class="h2">One last thing</div>
      <p class="p">A very normal question (I‚Äôm lying). üíå</p>
      <div class="divider"></div>

      <div class="postcard" id="postcard">
        <div class="postmark">
          <span>POST</span><span>LOVE</span><span>STAMP</span>
        </div>
        <div class="kiss">üíã</div>

        <div class="h2" style="margin-top: 18px;">Will you be my Valentine?</div>
        <p class="p" style="max-width: 52ch; margin-top: 10px;">
          Answer correctly (there is only one correct answer).
        </p>

        <div class="btnrow" id="btnRowFinal" style="margin-top: 18px;">
          <button class="btn primary" id="yesBtn">YES üíò</button>
          <button class="btn ghost" id="maybeBtn">maybe üôà</button>
        </div>

        <div class="waxSeal" id="waxSeal" aria-hidden="true"></div>
      </div>

      <!-- Hidden obnoxious celebration -->
      <div id="partyArea" style="display:none;">
        <div class="memeBlock">
          <!-- put pray-crying.gif next to this html file -->
          <img src="pray-crying.gif" alt="meme" />
          <div class="memeCap">me being so normal about this</div>
          <div class="memeCap small">anyway yeah no big deal or anything</div>
        </div>

        <p class="p" style="font-weight:900; font-size: clamp(20px, 2.8vw, 28px);">
          CONGRATS üéâ I will now be unbearable about this.
        </p>

        <div class="btnrow">
          <button class="btn primary" id="restartBtn" style="font-size:22px;padding:18px 40px;">
            Play again
          </button>
        </div>
      </div>
    </div>
  </section>

<script>
/* =========================
   CUSTOMIZE SECTION
========================= */
function normalize(s){
  return (s || "").toUpperCase().replace(/[^A-Z0-9]/g,"");
}

const CROSSWORD = [
  { clue: "Our favorite date spot?", answer: "CARROLLTON" },
  { clue: "Our favorite brunch spot?", answer: "EGGTASTIC" },
  { clue: "Our best trip?", answer: "NEW YORK" }
];

const GAME2 = {
  question: "Where did we have our first date?",
  choices: ["Panera Bread", "Chili's", "Olive Garden", "In-N-Out"],
  correctIndex: 0
};

const HEART_CATCH = {
  goal: 10,
  seconds: 12
};

/* =========================
   HELPERS
========================= */
const toastEl = document.getElementById("toast");
function toast(msg){
  toastEl.textContent = msg;
  toastEl.classList.add("show");
  setTimeout(()=>toastEl.classList.remove("show"), 1100);
}

function go(pageIndex){
  for(let i=0;i<=4;i++){
    document.getElementById("p"+i).classList.remove("active");
  }
  document.getElementById("p"+pageIndex).classList.add("active");

  const scenes = ["welcome","game1","game2","game3","final"];
  document.body.setAttribute("data-scene", scenes[pageIndex] || "welcome");

  document.getElementById("p"+pageIndex).scrollTop = 0;

  // start/stop final-page behaviors
  if(pageIndex === 4) startFinalBehaviors();
  else stopFinalBehaviors();
}

/* Confetti hearts */
function confettiHearts(count=30){
  const hearts = ["üíñ","üíò","üíù","üíó","üíï","üíû"];
  for(let i=0;i<count;i++){
    const el = document.createElement("div");
    el.className = "confetti";
    el.textContent = hearts[Math.floor(Math.random()*hearts.length)];
    el.style.left = (Math.random()*100) + "vw";
    el.style.fontSize = (14 + Math.random()*22) + "px";
    el.style.animationDuration = (2.1 + Math.random()*2.4) + "s";
    document.body.appendChild(el);
    setTimeout(()=>el.remove(), 5200);
  }
}

/* Wax seal stamp re-trigger */
function stampSeal(){
  const seal = document.getElementById("waxSeal");
  if(!seal) return;
  seal.classList.remove("stamp");
  void seal.offsetHeight; // reflow
  seal.classList.add("stamp");
}

/* =========================
   LOCKING FLOW
========================= */
let unlocked = { p1:true, p2:false, p3:false, p4:false };

document.getElementById("startBtn").onclick = ()=> {
  toast("Good luck üòå");
  go(1);
};

/* =========================
   GAME 1: CROSSWORD
========================= */
const cwGrid = document.getElementById("cwGrid");
const clues = document.getElementById("clues");
const cwCheckBtn = document.getElementById("cwCheckBtn");
const cwClearBtn = document.getElementById("cwClearBtn");
const cwMsg = document.getElementById("cwMsg");
const g1NextRow = document.getElementById("g1NextRow");
let cwRows = [];

function buildCrossword(){
  cwGrid.innerHTML = "";
  clues.innerHTML = "";
  cwRows = [];
  cwMsg.textContent = "";
  cwMsg.className = "p";
  g1NextRow.style.display = "none";

  CROSSWORD.forEach((q, ri)=>{
    const rowEl = document.createElement("div");
    rowEl.className = "cwRow";
    const answer = normalize(q.answer);
    const inputs = [];

    for(let i=0;i<answer.length;i++){
      const cell = document.createElement("div");
      cell.className = "cell";

      if(i===0){
        const n = document.createElement("div");
        n.className = "number";
        n.textContent = ri+1;
        cell.appendChild(n);
      }

      const inp = document.createElement("input");
      inp.maxLength = 1;

      inp.addEventListener("input", ()=>{
        inp.value = inp.value.toUpperCase().replace(/[^A-Z0-9]/g,"");
        if(inp.value && i < inputs.length-1) inputs[i+1].focus();
        updateCrosswordRow(ri);
      });

      inp.addEventListener("keydown", (e)=>{
        if(e.key==="Backspace" && !inp.value && i>0) inputs[i-1].focus();
        setTimeout(()=>updateCrosswordRow(ri), 0);
        if(e.key==="Enter") checkCrosswordAll();
      });

      cell.appendChild(inp);
      rowEl.appendChild(cell);
      inputs.push(inp);
    }

    cwGrid.appendChild(rowEl);
    cwRows.push({rowEl, inputs, answer, ok:false});

    const c = document.createElement("div");
    c.className = "clue";
    c.innerHTML = `<b>${ri+1}.</b><div>${q.clue}</div>`;
    clues.appendChild(c);
  });

  cwRows[0]?.inputs[0]?.focus();
}

function rowGuess(r){
  return normalize(r.inputs.map(x=>x.value).join(""));
}

function updateCrosswordRow(i){
  const r = cwRows[i];
  const guess = rowGuess(r);
  const correct = guess.length === r.answer.length && guess === r.answer;

  if(correct && !r.ok){
    r.ok = true;
    r.rowEl.classList.add("correct");
    toast("Okay smarty üôÑüß†");
  }
  if(!correct && r.ok){
    r.ok = false;
    r.rowEl.classList.remove("correct");
  }

  if(cwRows.every(x=>x.ok)){
    cwRows.forEach(x=>x.inputs.forEach(inp=>inp.disabled=true));
    confettiHearts(22);
    cwMsg.textContent = "Yeah‚Ä¶ this was too easy for you.";
    cwMsg.className = "p";
    unlocked.p2 = true;
    g1NextRow.style.display = "flex";
    setTimeout(()=>toast("Unlocked ‚ú®"), 200);
  }
}

function checkCrosswordAll(){
  cwRows.forEach((_,i)=>updateCrosswordRow(i));
  if(!cwRows.every(x=>x.ok)){
    cwMsg.textContent = "Hmm‚Ä¶ concerning üò¨ try again";
    cwMsg.className = "p";
    toast("Not yet üíî");
  }
}

function clearCrossword(){
  cwRows.forEach(r=>{
    r.inputs.forEach(i=>{
      i.disabled = false;
      i.value="";
    });
    r.ok=false;
    r.rowEl.classList.remove("correct");
  });
  cwMsg.textContent = "";
  g1NextRow.style.display = "none";
  cwRows[0]?.inputs[0]?.focus();
}

cwCheckBtn.onclick = checkCrosswordAll;
cwClearBtn.onclick = clearCrossword;
document.getElementById("g1Next").onclick = ()=>{
  if(!unlocked.p2){ toast("Not unlocked yet"); return; }
  go(2);
};

/* =========================
   GAME 2: QUIZ
========================= */
const quizBox = document.getElementById("quizBox");
const qMsg = document.getElementById("qMsg");
const g2NextRow = document.getElementById("g2NextRow");
let selected = null;

function buildQuiz(){
  quizBox.innerHTML = "";
  qMsg.textContent = "";
  qMsg.className = "p";
  g2NextRow.style.display = "none";
  selected = null;

  const title = document.createElement("div");
  title.className = "qTitle";
  title.textContent = GAME2.question;
  quizBox.appendChild(title);

  const choices = document.createElement("div");
  choices.className = "choices";

  GAME2.choices.forEach((txt, idx)=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "choice";
    b.textContent = txt;
    b.onclick = ()=>{
      [...choices.children].forEach(x=>x.classList.remove("selected"));
      b.classList.add("selected");
      selected = idx;
    };
    choices.appendChild(b);
  });

  quizBox.appendChild(choices);
}

function gradeQuiz(){
  if(selected === null){
    qMsg.textContent = "Pick one üòå";
    qMsg.className = "p";
    toast("Choose an answer");
    return;
  }

  const btns = [...quizBox.querySelectorAll(".choice")];
  btns.forEach((b,i)=>{
    b.classList.remove("correct","wrong");
    if(i === GAME2.correctIndex) b.classList.add("correct");
    if(i === selected && selected !== GAME2.correctIndex) b.classList.add("wrong");
  });

  if(selected !== GAME2.correctIndex){
    qMsg.textContent = "Close‚Ä¶ but no. Try again üíå";
    qMsg.className = "p";
    toast("Wrong üíî");
    return;
  }

  qMsg.textContent = "Correct. I knew you‚Äôd get it üòå";
  qMsg.className = "p";
  toast("Unlocked ‚ú®");
  confettiHearts(16);
  unlocked.p3 = true;
  g2NextRow.style.display = "flex";
}

document.getElementById("qReset").onclick = buildQuiz;
document.getElementById("qSubmit").onclick = gradeQuiz;
document.getElementById("g2Next").onclick = ()=>{
  if(!unlocked.p3){ toast("Not unlocked yet"); return; }
  go(3);
};

/* =========================
   GAME 3: HEART CATCH
========================= */
const arena = document.getElementById("arena");
const scoreEl = document.getElementById("score");
const goalEl = document.getElementById("goal");
const timeEl = document.getElementById("time");
const hcMsg = document.getElementById("hcMsg");
const g3NextRow = document.getElementById("g3NextRow");

goalEl.textContent = String(HEART_CATCH.goal);

let running = false;
let score = 0;
let timeLeft = HEART_CATCH.seconds;
let timer = null;
let spawner = null;

function resetCatch(){
  running = false;
  score = 0;
  timeLeft = HEART_CATCH.seconds;
  scoreEl.textContent = "0";
  timeEl.textContent = String(timeLeft);
  arena.innerHTML = "";
  hcMsg.textContent = "";
  hcMsg.className = "p";
  g3NextRow.style.display = "none";
  clearInterval(timer); timer=null;
  clearInterval(spawner); spawner=null;
}

function spawnHeart(){
  const hearts = ["üíñ","üíò","üíù","üíó","üíï","üíû"];
  const h = document.createElement("div");
  h.className = "fall";
  h.textContent = hearts[Math.floor(Math.random()*hearts.length)];
  h.style.left = (Math.random() * Math.max(10, arena.clientWidth - 30)) + "px";
  h.style.fontSize = (20 + Math.random()*22) + "px";
  h.style.animationDuration = (1.4 + Math.random()*1.4) + "s";

  h.onclick = ()=>{
    if(!running) return;
    score += 1;
    scoreEl.textContent = String(score);
    h.remove();
    if(score >= HEART_CATCH.goal) winCatch();
  };

  h.addEventListener("animationend", ()=> h.remove());
  arena.appendChild(h);
}

function startCatch(){
  if(running) return;
  resetCatch();
  running = true;
  toast("Go üíñ");

  timer = setInterval(()=>{
    timeLeft -= 1;
    timeEl.textContent = String(timeLeft);
    if(timeLeft <= 0) endCatch(false);
  }, 1000);

  spawner = setInterval(spawnHeart, 420);
}

function endCatch(won){
  running = false;
  clearInterval(timer); timer=null;
  clearInterval(spawner); spawner=null;
  if(!won){
    hcMsg.textContent = "You ran out of time üò≠ try again.";
    hcMsg.className = "p";
    toast("Again üòå");
  }
}

function winCatch(){
  endCatch(true);
  hcMsg.textContent = "Okay clutch actually üò§";
  hcMsg.className = "p";
  toast("Unlocked ‚ú®");
  confettiHearts(28);
  unlocked.p4 = true;
  g3NextRow.style.display = "flex";
}

document.getElementById("hcReset").onclick = resetCatch;
document.getElementById("hcStart").onclick = startCatch;
document.getElementById("g3Next").onclick = ()=>{
  if(!unlocked.p4){ toast("Not unlocked yet"); return; }
  go(4);
};

/* =========================
   FINAL PAGE: YES grows + MAYBE runs obnoxiously
========================= */
const yesBtn = document.getElementById("yesBtn");
const maybeBtn = document.getElementById("maybeBtn");
const btnRowFinal = document.getElementById("btnRowFinal");
const partyArea = document.getElementById("partyArea");
const postcard = document.getElementById("postcard");

let partyTimer = null;

/* YES grows while on final page */
let yesGrowTimer = null;
let yesScale = 1;
function startFinalBehaviors(){
  // reset
  yesScale = 1;
  yesBtn.style.transform = "scale(1)";
  yesBtn.id = "yesBtn"; // keep stable
  // grow every 1s, cap at 1.85
  if(yesGrowTimer) clearInterval(yesGrowTimer);
  yesGrowTimer = setInterval(()=>{
    yesScale = Math.min(1.85, yesScale + 0.06);
    yesBtn.style.transform = `scale(${yesScale})`;
  }, 1000);
}
function stopFinalBehaviors(){
  if(yesGrowTimer){ clearInterval(yesGrowTimer); yesGrowTimer = null; }
}

/* Obnoxious MAYBE movement */
let maybeChaosTimer = null;
function moveMaybeOnce(){
  // ensure it can move inside the row
  maybeBtn.style.position = "absolute";

  const r = btnRowFinal.getBoundingClientRect();
  const btnW = maybeBtn.offsetWidth || 110;
  const btnH = maybeBtn.offsetHeight || 52;

  const maxX = Math.max(0, r.width - btnW);
  const maxY = Math.max(0, r.height - btnH);

  const x = Math.random() * maxX;
  const y = Math.random() * maxY;

  const rot = (Math.random()*24 - 12);
  const sk = (Math.random()*6 - 3);

  maybeBtn.style.left = x + "px";
  maybeBtn.style.top  = y + "px";
  maybeBtn.style.transform = `rotate(${rot}deg) skewX(${sk}deg)`;
}

function startMaybeChaos(){
  // immediate move + rapid spam moves
  moveMaybeOnce();
  toast("Don‚Äôt do this üòê");

  if(maybeChaosTimer) clearInterval(maybeChaosTimer);
  let ticks = 0;

  maybeChaosTimer = setInterval(()=>{
    moveMaybeOnce();
    ticks++;
    // after a bit, stop rapid spam but keep annoying
    if(ticks > 14){
      clearInterval(maybeChaosTimer);
      maybeChaosTimer = null;
    }
  }, 120);
}

maybeBtn.addEventListener("mouseenter", startMaybeChaos);
maybeBtn.addEventListener("click", (e)=>{
  e.preventDefault();
  startMaybeChaos();
  toast("Nice try üòå");
});

/* Nonstop confetti + meme after YES */
function startParty(){
  document.body.classList.add("party");
  partyArea.style.display = "block";
  confettiHearts(100);
  if(partyTimer) clearInterval(partyTimer);
  partyTimer = setInterval(()=> confettiHearts(40), 850);
}

function stopParty(){
  document.body.classList.remove("party");
  if(partyTimer) clearInterval(partyTimer);
  partyTimer = null;
}

yesBtn.onclick = ()=>{
  stampSeal();
  startParty();
  toast("Correct answer ‚úÖ");
  if (navigator.vibrate) navigator.vibrate([25, 40, 20]);
  postcard.scrollIntoView({behavior:"smooth", block:"center"});
};

document.getElementById("restartBtn").onclick = ()=>{
  stopParty();
  partyArea.style.display = "none";

  // reset maybe positioning
  maybeBtn.style.position = "relative";
  maybeBtn.style.left = "";
  maybeBtn.style.top = "";
  maybeBtn.style.transform = "";

  // reset unlocks + rebuild games
  unlocked = { p1:true, p2:false, p3:false, p4:false };
  buildCrossword();
  buildQuiz();
  resetCatch();
  go(0);
};

/* =========================
   INIT
========================= */
function init(){
  buildCrossword();
  buildQuiz();
  resetCatch();
  go(0);
}
init();
</script>
</body>
</html>